(function(){"use strict";const Y=self,ht=5.8,dt=2048,j=[[1,0],[-.5,Math.sqrt(3)/2],[-.5,-Math.sqrt(3)/2]],P=[[255,80,80],[80,255,80],[80,80,255]];Y.onmessage=bt=>{const Mt=performance.now(),l=bt.data,y=l.width,W=l.height,D=l.yStart,H=l.bandHeight,lt=l.bandIndex,ft=l.frameId,_=new ArrayBuffer(y*H*4),B=new Uint32Array(_),i=l.cReal,h=l.cImag,It=l.zoom,V=l.centerX,Z=l.centerY,F=l.rotation||0,C=l.maxIterations,f=l.fractalType,J=l.phoenixP,E=l.colorLUT,L=ht/It,K=L*(W/y),mt=V-L/2,kt=Z-K/2,xt=L/y,Rt=K/W,Q=Math.cos(F),$=Math.sin(F),tt=V,st=Z,nt=1/C,gt=Math.log(f===1?3:f===2?4:2),U=dt-1,zt=f===10||f===11||f===13||f===19;for(let u=0;u<H;u++){const ut=D+u,pt=kt+ut*Rt;for(let p=0;p<y;p++){const ot=mt+p*xt-tt,ct=pt-st,at=tt+ot*Q-ct*$,et=st+ot*$+ct*Q,A=f===18;let s=A?0:at,o=A?0:et;const qt=A?at:i,vt=A?et:h;let d=s*s,b=o*o,q=0,rt=0,it=0,v=-1;const wt=f===7||f===11||f===13?100:4;for(;d+b<=wt&&q<C;){if(f===10||f===11){const t=f===11?1e-6:1e-4;for(let n=0;n<3;n++){const c=s-j[n][0],r=o-j[n][1];if(c*c+r*r<t){v=n;break}}if(v>=0)break}if((f===13||f===19)&&(s-1)*(s-1)+o*o<1e-4){v=0;break}let a,e;switch(f){case 1:a=s*d-3*s*b+i,e=3*d*o-o*b+h;break;case 2:a=d*d-6*d*b+b*b+i,e=4*s*o*(d-b)+h;break;case 3:{const t=Math.abs(s),n=Math.abs(o);a=t*t-n*n+i,e=2*t*n+h;break}case 4:a=d-b+i,e=-2*s*o+h;break;case 5:a=d-b+i+J*rt,e=2*s*o+h+J*it,rt=s,it=o;break;case 6:a=Math.abs(d-b)+i,e=2*s*o+h;break;case 8:{const t=Math.abs(o);a=d-t*t+i,e=2*s*t+h;break}case 9:{const t=Math.abs(s),n=Math.abs(o),c=t*t-n*n,r=2*t*n;a=c-t+i,e=r-n+h;break}case 7:{const t=1-s,n=-o,c=s*t-o*n,r=s*n+o*t;a=i*c-h*r,e=i*r+h*c;break}case 10:{const t=d+b;if(t<1e-10){a=s,e=o;break}const n=Math.sqrt(t),c=Math.atan2(o,s),r=n*n*n,M=r*Math.cos(3*c),x=r*Math.sin(3*c),k=t,I=3*k*Math.cos(2*c),m=3*k*Math.sin(2*c),g=M-1,z=x,R=I*I+m*m;if(R<1e-10){a=s,e=o;break}const w=(g*I+z*m)/R,T=(z*I-g*m)/R;a=s-w,e=o-T;break}case 11:{const t=d+b;if(t<1e-10){a=i,e=h;break}const n=Math.sqrt(t),c=Math.atan2(o,s),r=n*n*n,M=r*Math.cos(3*c),x=r*Math.sin(3*c),k=t,I=3*k*Math.cos(2*c),m=3*k*Math.sin(2*c),g=M-1,z=x,R=I*I+m*m;if(R<1e-10){a=s+i,e=o+h;break}const w=(g*I+z*m)/R,T=(z*I-g*m)/R;a=s-w+i,e=o-T+h;break}case 13:{const t=d-b+i-1,n=2*s*o+h,c=2*s+i-2,r=2*o+h,M=c*c+r*r;if(M<1e-10){a=1e10,e=1e10;break}const x=(t*c+n*r)/M,k=(n*c-t*r)/M;a=x*x-k*k,e=2*x*k;break}case 14:{const t=s>=0?s-1:s+1;a=t*i-o*h,e=t*h+o*i;break}case 15:{const n=s*h+o*i>=0?s-1:s+1;a=n*i-o*h,e=n*h+o*i;break}case 16:{const t=d-b-1,n=2*s*o;s>0?(a=t+i,e=n+h):(a=t+i*s+i,e=n+h*s+h);break}case 17:{const t=Math.sqrt(d+b),n=Math.atan2(-o,s),c=t*t*t;a=c*Math.cos(3*n)+i,e=c*Math.sin(3*n)+h;break}case 18:a=d-b+qt,e=2*s*o+vt;break;case 19:{const t=i-1,n=h,c=i-2,r=h,M=t*c-n*r,x=t*r+n*c,k=s*d-3*s*b,I=3*d*o-o*b,m=3*(t*s-n*o),g=3*(t*o+n*s),z=k+m+M,R=I+g+x,w=3*(d-b),T=3*2*s*o,Tt=3*(c*s-r*o),At=3*(c*o+r*s),O=w+Tt+M+1,S=T+At+x,G=O*O+S*S;if(G<1e-10){a=1e10,e=1e10;break}const N=(z*O+R*S)/G,X=(R*O-z*S)/G;a=N*N-X*X,e=2*N*X;break}default:a=d-b+i,e=2*s*o+h;break}s=a,o=e,d=s*s,b=o*o,q++}if(q===C&&v<0)B[u*y+p]=0;else if(zt&&v>=0){const a=P[v%P.length],e=.15+.45*(1-q*nt),t=Math.min(255,Math.max(0,a[0]*e|0)),n=Math.min(255,Math.max(0,a[1]*e|0)),c=Math.min(255,Math.max(0,a[2]*e|0)),r=t>n?t>c?t:c:n>c?n:c;let M=r<15?0:(r-15)*4;M>255&&(M=255),B[u*y+p]=M<<24|c<<16|n<<8|t}else{const a=Math.log(d+b),e=a>0?q+1-Math.log(.5*a)/gt:q,t=e>0?e:0;let c=Math.sqrt(t*nt)*U|0;c>U&&(c=U);const r=c*3,M=E[r],x=E[r+1],k=E[r+2],I=M>0?M<255?M|0:255:0,m=x>0?x<255?x|0:255:0,g=k>0?k<255?k|0:255:0,z=I>m?I>g?I:g:m>g?m:g;let R=z<15?0:(z-15)*4;R>255&&(R=255),B[u*y+p]=R<<24|g<<16|m<<8|I}}}const yt=performance.now()-Mt;Y.postMessage({type:"band",buffer:_,width:y,bandHeight:H,yStart:D,bandIndex:lt,frameId:ft,renderMs:yt},[_])}})();
