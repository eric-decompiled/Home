<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 480" width="1000" height="480">
  <!-- svg-source:excalidraw -->
  <metadata></metadata>
  <defs>
    <style>
      text { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#868e96"/>
    </marker>
  </defs>
  <rect x="0" y="0" width="1000" height="480" fill="#1e1e1e"/>

  <!-- Title -->
  <text x="500" y="32" font-size="22" fill="#e0e0e0" text-anchor="middle" font-weight="bold">The Fractured Jukebox - System Architecture</text>

  <!-- ROW 1: Input & Analysis -->

  <!-- MIDI File -->
  <rect x="30" y="70" width="110" height="55" rx="8" fill="#a5d8ff" stroke="#339af0" stroke-width="2"/>
  <text x="85" y="103" font-size="14" fill="#1e1e1e" text-anchor="middle" font-weight="bold">MIDI File</text>

  <!-- Arrow -->
  <path d="M140 97 L175 97" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

  <!-- MIDI Analyzer -->
  <rect x="180" y="60" width="140" height="75" rx="8" fill="#b2f2bb" stroke="#40c057" stroke-width="2"/>
  <text x="250" y="88" font-size="14" fill="#1e1e1e" text-anchor="middle" font-weight="bold">MIDI Analyzer</text>
  <text x="250" y="106" font-size="10" fill="#495057" text-anchor="middle">chords, key, drums</text>
  <text x="250" y="121" font-size="10" fill="#495057" text-anchor="middle">notes, tempo</text>

  <!-- Arrow -->
  <path d="M320 97 L355 97" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

  <!-- Audio Player -->
  <rect x="360" y="60" width="130" height="75" rx="8" fill="#ffc9c9" stroke="#fa5252" stroke-width="2"/>
  <text x="425" y="88" font-size="14" fill="#1e1e1e" text-anchor="middle" font-weight="bold">Audio Player</text>
  <text x="425" y="106" font-size="10" fill="#495057" text-anchor="middle">SpessaSynth</text>
  <text x="425" y="121" font-size="10" fill="#495057" text-anchor="middle">MIDI playback</text>

  <!-- ROW 2: Data Structures -->

  <!-- Arrow down from Analyzer -->
  <path d="M250 135 L250 160" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

  <!-- MusicTimeline -->
  <rect x="180" y="165" width="140" height="50" rx="8" fill="#ffec99" stroke="#fab005" stroke-width="2"/>
  <text x="250" y="195" font-size="13" fill="#1e1e1e" text-anchor="middle" font-weight="bold">MusicTimeline</text>

  <!-- Arrow down from Audio -->
  <path d="M425 135 L425 160" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="435" y="152" font-size="9" fill="#868e96">time</text>

  <!-- Beat Sync -->
  <rect x="360" y="165" width="130" height="50" rx="8" fill="#ffe066" stroke="#f59f00" stroke-width="2"/>
  <text x="425" y="188" font-size="13" fill="#1e1e1e" text-anchor="middle" font-weight="bold">Beat Sync</text>
  <text x="425" y="203" font-size="9" fill="#495057" text-anchor="middle">groove curves</text>

  <!-- ROW 3: Processing -->

  <!-- Arrows from Timeline and BeatSync to Music Mapper -->
  <path d="M250 215 L250 245 L295 245" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M425 215 L425 245 L505 245" stroke="#868e96" stroke-width="2" fill="none"/>

  <!-- Music Mapper -->
  <rect x="300" y="240" width="200" height="115" rx="8" fill="#d0bfff" stroke="#7950f2" stroke-width="2"/>
  <text x="400" y="268" font-size="14" fill="#1e1e1e" text-anchor="middle" font-weight="bold">Music Mapper</text>

  <!-- Inner sections -->
  <rect x="312" y="280" width="176" height="22" rx="4" fill="#e5dbff" stroke="none"/>
  <text x="400" y="295" font-size="10" fill="#495057" text-anchor="middle">Harmony: tension, chords, anchors</text>

  <rect x="312" y="305" width="176" height="22" rx="4" fill="#e5dbff" stroke="none"/>
  <text x="400" y="320" font-size="10" fill="#495057" text-anchor="middle">Rhythm: drums, fills, sections</text>

  <rect x="312" y="330" width="176" height="22" rx="4" fill="#e5dbff" stroke="none"/>
  <text x="400" y="345" font-size="10" fill="#495057" text-anchor="middle">Melodic: voices, lookahead</text>

  <!-- Arrow from Music Mapper to MusicParams -->
  <path d="M500 297 L545 297" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

  <!-- MusicParams -->
  <rect x="550" y="245" width="145" height="105" rx="8" fill="#ffd8a8" stroke="#fd7e14" stroke-width="2"/>
  <text x="622" y="273" font-size="14" fill="#1e1e1e" text-anchor="middle" font-weight="bold">MusicParams</text>
  <text x="622" y="292" font-size="9" fill="#495057" text-anchor="middle">timing, groove curves</text>
  <text x="622" y="306" font-size="9" fill="#495057" text-anchor="middle">tension, drums, melody</text>
  <text x="622" y="320" font-size="9" fill="#495057" text-anchor="middle">active voices, chords</text>
  <text x="622" y="334" font-size="9" fill="#495057" text-anchor="middle">upcoming notes/chords</text>

  <!-- Arrow from MusicParams to Effects -->
  <path d="M695 297 L730 297" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

  <!-- EFFECTS SECTION -->

  <!-- Effects container -->
  <rect x="735" y="60" width="245" height="290" rx="8" fill="#2d2d2d" stroke="#495057" stroke-width="1"/>
  <text x="857" y="85" font-size="13" fill="#e0e0e0" text-anchor="middle" font-weight="bold">Effect Layers</text>

  <!-- Background Effects -->
  <rect x="747" y="100" width="110" height="55" rx="6" fill="#4a5568" stroke="none"/>
  <text x="802" y="118" font-size="11" fill="#e0e0e0" text-anchor="middle" font-weight="bold">Background</text>
  <text x="802" y="133" font-size="9" fill="#a0aec0" text-anchor="middle">Starfield, Flow Field</text>
  <text x="802" y="145" font-size="9" fill="#a0aec0" text-anchor="middle">Domain Warp, Chladni</text>

  <!-- Foreground Effects -->
  <rect x="862" y="100" width="110" height="55" rx="6" fill="#553c9a" stroke="none"/>
  <text x="917" y="118" font-size="11" fill="#e0e0e0" text-anchor="middle" font-weight="bold">Foreground</text>
  <text x="917" y="133" font-size="9" fill="#d6bcfa" text-anchor="middle">Graph Chain, Spiral</text>
  <text x="917" y="145" font-size="9" fill="#d6bcfa" text-anchor="middle">Fractal, Piano Roll</text>

  <!-- Melody/Bass Effects -->
  <rect x="747" y="160" width="110" height="55" rx="6" fill="#c05621" stroke="none"/>
  <text x="802" y="178" font-size="11" fill="#e0e0e0" text-anchor="middle" font-weight="bold">Melody/Bass</text>
  <text x="802" y="193" font-size="9" fill="#fbd38d" text-anchor="middle">Clock, Fire, Aurora</text>
  <text x="802" y="205" font-size="9" fill="#fbd38d" text-anchor="middle">Web</text>

  <!-- Overlay Effects -->
  <rect x="862" y="160" width="110" height="55" rx="6" fill="#2c7a7b" stroke="none"/>
  <text x="917" y="178" font-size="11" fill="#e0e0e0" text-anchor="middle" font-weight="bold">Overlay</text>
  <text x="917" y="193" font-size="9" fill="#81e6d9" text-anchor="middle">Kaleidoscope</text>
  <text x="917" y="205" font-size="9" fill="#81e6d9" text-anchor="middle">Feedback Trail</text>

  <!-- HUD -->
  <rect x="804" y="220" width="110" height="40" rx="6" fill="#2d3748" stroke="#a0aec0" stroke-width="1"/>
  <text x="859" y="238" font-size="11" fill="#e0e0e0" text-anchor="middle" font-weight="bold">HUD</text>
  <text x="859" y="253" font-size="9" fill="#a0aec0" text-anchor="middle">Theory Bar</text>

  <!-- Compositor -->
  <rect x="792" y="270" width="130" height="45" rx="6" fill="#eebefa" stroke="#be4bdb" stroke-width="2"/>
  <text x="857" y="293" font-size="12" fill="#1e1e1e" text-anchor="middle" font-weight="bold">Compositor</text>
  <text x="857" y="307" font-size="9" fill="#495057" text-anchor="middle">blend, opacity, stack</text>

  <!-- Arrow down to Canvas -->
  <path d="M857 315 L857 340" stroke="#868e96" stroke-width="2" fill="none"/>

  <!-- Canvas -->
  <rect x="792" y="325" width="130" height="50" rx="8" fill="#69db7c" stroke="#40c057" stroke-width="2"/>
  <text x="857" y="357" font-size="16" fill="#1e1e1e" text-anchor="middle" font-weight="bold">Canvas</text>

  <!-- OUTPUT arrow -->
  <path d="M857 375 L857 400" stroke="#868e96" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="857" y="420" font-size="11" fill="#69db7c" text-anchor="middle">Screen</text>

  <!-- Decorative flow indicators -->
  <text x="30" y="455" font-size="10" fill="#495057">MIDI Input</text>
  <path d="M90 450 L200 450" stroke="#495057" stroke-width="1" stroke-dasharray="4,2" fill="none" marker-end="url(#arrow)"/>
  <text x="220" y="455" font-size="10" fill="#495057">Analysis</text>
  <path d="M275 450 L390 450" stroke="#495057" stroke-width="1" stroke-dasharray="4,2" fill="none" marker-end="url(#arrow)"/>
  <text x="410" y="455" font-size="10" fill="#495057">Mapping</text>
  <path d="M465 450 L580 450" stroke="#495057" stroke-width="1" stroke-dasharray="4,2" fill="none" marker-end="url(#arrow)"/>
  <text x="600" y="455" font-size="10" fill="#495057">Effects</text>
  <path d="M640 450 L755 450" stroke="#495057" stroke-width="1" stroke-dasharray="4,2" fill="none" marker-end="url(#arrow)"/>
  <text x="775" y="455" font-size="10" fill="#495057">Render</text>
</svg>
